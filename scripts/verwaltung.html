<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bilderrahmen Verwaltung</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 40px; color: white; }
        .header h1 { font-size: 2.5rem; font-weight: 700; margin-bottom: 10px; }
        .header p { font-size: 1.1rem; opacity: 0.9; }
        .panel { background: rgba(255,255,255,0.95); border-radius: 20px; padding: 25px; margin-bottom: 25px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); }
        .panel h3 { margin-bottom: 20px; color: #333; font-size: 1.3rem; }
        .settings { display: flex; gap: 25px; align-items: center; flex-wrap: wrap; padding: 15px; background: #f8f9fa; border-radius: 12px; }
        .settings label { font-weight: 500; color: #333; }
        .settings select { padding: 10px 15px; border-radius: 8px; border: 2px solid #e9ecef; font-size: 1rem; }
        .checkbox-label { display: flex; align-items: center; cursor: pointer; }
        .checkbox-label input { margin-right: 8px; transform: scale(1.3); }
        .links-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; }
        .link-card { background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 12px; padding: 20px; color: #333; transition: all 0.3s ease; display: flex; align-items: center; gap: 15px; cursor: pointer; }
        .link-card:hover { background: #e9ecef; transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .link-icon { font-size: 2rem; width: 50px; text-align: center; }
        .link-text h4 { margin-bottom: 5px; font-size: 1.1rem; }
        .link-text p { font-size: 0.85rem; color: #666; }
        .folder-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25px; }
        .folder-card { background: rgba(255,255,255,0.95); border-radius: 20px; padding: 25px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); position: relative; overflow: hidden; transition: all 0.3s ease; }
        .folder-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #667eea, #764ba2); }
        .folder-card:hover { transform: translateY(-5px); }
        .folder-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
        .folder-name { font-size: 1.4rem; font-weight: 600; color: #333; display: flex; align-items: center; gap: 10px; text-transform: capitalize; }
        .folder-icon { width: 40px; height: 40px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.2rem; }
        .folder-badge { background: #667eea; color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; }
        .button-group { display: flex; gap: 10px; flex-wrap: wrap; }
        .btn { padding: 12px 20px; border: none; border-radius: 12px; cursor: pointer; font-size: 0.9rem; font-weight: 500; transition: all 0.2s ease; display: inline-flex; align-items: center; gap: 8px; min-width: 140px; justify-content: center; }
        .btn-primary { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4); }
        .btn-secondary { background: #f8f9fa; color: #333; border: 2px solid #e9ecef; }
        .btn-secondary:hover { background: #e9ecef; }
        .loading { text-align: center; padding: 40px; color: white; font-size: 1.2rem; }
        .error { background: rgba(255,107,107,0.1); border: 2px solid rgba(255,107,107,0.3); color: #ff6b6b; padding: 20px; border-radius: 12px; text-align: center; }
        .refresh-btn { position: fixed; bottom: 30px; right: 30px; width: 70px; height: 70px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; font-size: 1.5rem; cursor: pointer; box-shadow: 0 8px 25px rgba(102,126,234,0.4); transition: all 0.3s ease; z-index: 100; }
        .refresh-btn:hover { transform: scale(1.1) rotate(180deg); }
        .saved { color: #28a745; font-size: 0.9rem; margin-left: 10px; }
        @media (max-width: 768px) { .header h1 { font-size: 1.8rem; } .folder-grid, .links-grid { grid-template-columns: 1fr; } .button-group { flex-direction: column; } .btn { min-width: 100%; } .settings { flex-direction: column; align-items: stretch; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üñºÔ∏è Bilderrahmen Verwaltung</h1>
            <p>Verwalte deine Kita-Fotos nach Gruppen</p>
        </div>
        <div class="panel">
            <h3>‚öôÔ∏è Slideshow-Einstellungen <span class="saved" id="saved" style="display:none">‚úì Gespeichert</span></h3>
            <div class="settings">
                <div>
                    <label for="speed">üïê Bildwechsel:</label>
                    <select id="speed" onchange="save()">
                        <option value="3000">3 Sek (schnell)</option>
                        <option value="5000">5 Sek (normal)</option>
                        <option value="8000">8 Sek (langsam)</option>
                        <option value="10000">10 Sek</option>
                        <option value="15000">15 Sek</option>
                        <option value="30000">30 Sek</option>
                    </select>
                </div>
                <label class="checkbox-label">
                    <input type="checkbox" id="shuffle" onchange="save()">
                    üîÄ Zuf√§llige Reihenfolge
                </label>
            </div>
        </div>
        <div class="panel">
            <h3>üì± Tablet-Links</h3>
            <div class="links-grid" id="links"><p>Lade...</p></div>
        </div>
        <div class="folder-grid" id="grid"><div class="loading">Lade Gruppen...</div></div>
    </div>
    <button class="refresh-btn" onclick="load()" title="Aktualisieren">‚Üª</button>
<script>
var folders = [];
var icons = {'kaefer':'üêõ','bienen':'üêù','schmetterlinge':'ü¶ã','froesche':'üê∏','maeuse':'üê≠','baeren':'üêª','spatzen':'üê¶','luftpiraten':'üè¥‚Äç‚ò†Ô∏è','marienkaefer':'üêû','klapperstoerche':'ü¶©','hasen':'üê∞','igel':'ü¶î','loewen':'ü¶Å','elefanten':'üêò'};

function icon(n) { return icons[n.toLowerCase()] || 'üì±'; }

function save() {
    localStorage.setItem('kita_speed', document.getElementById('speed').value);
    localStorage.setItem('kita_shuffle', document.getElementById('shuffle').checked);
    var s = document.getElementById('saved');
    s.style.display = 'inline';
    setTimeout(function() { s.style.display = 'none'; }, 2000);
}

function restore() {
    var sp = localStorage.getItem('kita_speed');
    if (sp) document.getElementById('speed').value = sp;
    var sh = localStorage.getItem('kita_shuffle');
    if (sh === 'true') document.getElementById('shuffle').checked = true;
}

function url(f) {
    var d = document.getElementById('speed').value;
    var s = document.getElementById('shuffle').checked;
    return '/scripts/slideshow.html?folder=' + encodeURIComponent(f) + '&delay=' + d + (s ? '&shuffle=true' : '');
}

function open_slide(f) { window.open(url(f), '_blank'); }

function open_win(f) {
    var h = window.location.hostname || 'bilderrahmen.local';
    var p = '\\\\' + h + '\\' + f;
    if (navigator.clipboard) {
        navigator.clipboard.writeText(p).then(function() {
            alert('‚úÖ Kopiert!\n\n' + p + '\n\nüëâ Win+E, Strg+V');
        }).catch(function() { prompt('Pfad:', p); });
    } else {
        prompt('Pfad:', p);
    }
}

function links() {
    var c = document.getElementById('links');
    c.innerHTML = '';
    if (!folders.length) { c.innerHTML = '<p>Keine Gruppen</p>'; return; }
    folders.forEach(function(f, i) {
        var d = document.createElement('div');
        d.className = 'link-card';
        d.onclick = function() { open_slide(f); };
        d.innerHTML = '<div class="link-icon">' + icon(f) + '</div><div class="link-text"><h4>Tablet ' + (i + 1) + ': ' + f.charAt(0).toUpperCase() + f.slice(1) + '</h4><p>Klick zum Starten</p></div>';
        c.appendChild(d);
    });
}

function card(f, cnt) {
    var g = document.getElementById('grid');
    var c = document.createElement('div');
    c.className = 'folder-card';
    c.innerHTML = '<div class="folder-header"><div class="folder-name"><div class="folder-icon">' + icon(f) + '</div>' + f.charAt(0).toUpperCase() + f.slice(1) + '</div><div class="folder-badge">' + cnt + ' Bilder</div></div><div class="button-group"><button class="btn btn-primary" onclick="open_slide(\'' + f + '\')">‚ñ∂Ô∏è Slideshow</button><button class="btn btn-secondary" onclick="open_win(\'' + f + '\')">üìÅ Windows</button></div>';
    g.appendChild(c);
}

function load() {
    var g = document.getElementById('grid');
    g.innerHTML = '<div class="loading">Lade...</div>';
    
    fetch('/Fotos/').then(function(r) { return r.text(); }).then(function(html) {
        var m = html.match(/href="([^"]+)\/"/g) || [];
        folders = [];
        m.forEach(function(x) {
            var n = x.replace('href="', '').replace('/"', '').replace('"', '');
            if (n && n !== '..' && n !== 'SYSTEM-BACKUP' && n !== 'lost+found' && !n.startsWith('.')) {
                folders.push(n);
            }
        });
        if (!folders.length) throw new Error('Keine Ordner');
        g.innerHTML = '';
        links();
        folders.forEach(function(f) {
            fetch('/scripts/get_images.php?folder=' + encodeURIComponent(f) + '&month=all&t=' + Date.now())
                .then(function(r) { return r.json(); })
                .then(function(d) { card(f, (d && d.count) || 0); })
                .catch(function() { card(f, 0); });
        });
    }).catch(function() {
        g.innerHTML = '<div class="error">Fehler beim Laden. Pr√ºfe /mnt/kita-fotos/</div>';
    });
}

document.addEventListener('DOMContentLoaded', function() {
    restore();
    load();
});

setInterval(load, 120000);
</script>
</body>
</html>
